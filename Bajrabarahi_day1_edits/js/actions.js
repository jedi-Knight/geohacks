$(document).ready(function () { $("#map").css({ height : $(document).innerHeight() - 20 }); var g = L.map("map", { center : [27.6440, 85.1208], zoom : 15, doubleClickZoom : true }); var d = L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { attribution : 'Map data and tiles &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://www.openstreetmap.org/copyright/">Read the Licence here</a> | Cartography &copy; <a href="http://kathmandulivinglabs.org">Kathmandu Living Labs</a>, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>', maxZoom : 19, minZoom : 1 }); d.addTo(g); L.control.scale().addTo(g); var f = L.markerClusterGroup({ showCoverageOnHover : false }); f.addTo(g); function e(i, l) { var j = $("<div></div>").addClass("table-content"); for (var k in i) { var h = $("<div></div>").addClass("table-row").append(function () { return i[k] ? $("<div></div>").text((k+"").replace("@","")).append($("<div></div>").text(i[k])) : "" }); l ? h.prependTo(j).addClass(k) : h.appendTo(j).addClass(k) } return $(j)[0] } function b(h) { return $("<div></div>").append($("<div class='title'></div>").text(h.type)).addClass("table container").addClass(h.type).append(new e(h.data)) } var a = L.popup({ autoPan : true, keepInView : true }); var c = L.geoJson(null, { onEachFeature : function (i, h) { setTimeout(function () { h._container.setAttribute("title", "यो एउटा " + i.geometry.type.replace("String", "") + " बस्तु हो। यस बस्तुबारे विस्तृत जान्कारिकलागी माउसले क्लिक  गर्नुहोस।"); h.setStyle({ color : "#333366", weight : 6, opacity : 0.9, fillColor : "#6666FF", fillOpacity : 0.2, className : "vector-layer" }); h.on("click", function (j) { a.setLatLng(j.latlng); a.openOn(g); a.setContent(new e(i.properties, true)); a.update() }) }, 0) } }).addTo(g); $.getJSON("data/summary.json", function (h) { new b(h).appendTo("body") }); $.getJSON("data/points.geojson", function (h) { setTimeout(function () { for (var i in h.features) { var j = L.marker(L.latLng(h.features[i].geometry.coordinates[1], h.features[i].geometry.coordinates[0]), { icon : L.divIcon({ iconSize : [25, 42], iconAnchor : [12.5, 40], html : "<img src='markers/yellow.png'/>" }), riseOnHover : true, title : "यो एउटा point बस्तु हो। यस point बारे विस्तृत जान्कारिकलागी माउसले क्लिक  गर्नुहोस।" }); j.bindPopup(new e(h.features[i].properties, true), { autoPan : true, keepInView : true, offset : L.point(0, -22) }); j.addTo(f); g.fire("zoomend") } }, 0) }); $.getJSON("data/lines.geojson", function (h) { c.addData(h) }); $.getJSON("data/multilinestrings.geojson", function (h) { c.addData(h) }); $.getJSON("data/multipolygons.geojson", function (h) { c.addData(h) }); g.on("zoomend", function () { setTimeout(function () { $("#map").find("div.marker-cluster").attrByFunction(function () { return { title : "यस क्लस्टरमा " + $(this).find("span").text() + " ओटा point बस्तुहरु छन्| नजीक बाट point हरु हेर्नकालागी  माउसले क्लिक गर्नुहोस|" } }) }, 0) }) }); $.fn.attrByFunction = function (a) { return $(this).each(function () { $(this).attr(a.call(this)) }) };